# AI Town - 智能体小镇模拟系统

## 项目概述

基于斯坦福大学 AI Town 论文的本地化实现，创建一个多智能体生活模拟系统，其中多个 AI 角色在虚拟小镇中自主生活、互动和发展。

## 核心特性

### 🤖 多智能体系统
- **多个 AI 角色**：每个角色有独特的性格、背景、目标
- **自主决策**：角色根据环境和记忆自主选择行动
- **持续运行**：系统7x24小时持续模拟，角色保持活跃

### 🏘️ 虚拟小镇环境
- **2D 地图系统**：像素风格的小镇布局
- **功能区域**：住宅、商店、咖啡厅、公园等
- **物理交互**：角色移动、碰撞检测、物品互动

### 🧠 智能体架构
- **记忆系统**：长期记忆、工作记忆、情节记忆
- **计划制定**：基于目标的行为规划
- **社交网络**：角色间的关系管理

### 💬 自然交互
- **对话系统**：角色间的自然语言交流
- **情感模型**：情绪状态影响行为决策
- **观察学习**：从环境和他人行为中学习

## 系统架构

```
ai_town/
├── core/                     # 核心系统
│   ├── world.py             # 世界状态管理
│   ├── time_manager.py      # 时间系统
│   └── event_system.py      # 事件处理
├── agents/                   # 智能体系统
│   ├── base_agent.py        # 智能体基类
│   ├── memory/              # 记忆系统
│   │   ├── memory_stream.py # 记忆流
│   │   ├── retrieval.py     # 记忆检索
│   │   └── reflection.py    # 反思机制
│   ├── planning/            # 规划系统
│   │   ├── planner.py       # 行为规划
│   │   └── goals.py         # 目标管理
│   └── characters/          # 角色定义
│       ├── alice.py         # 角色: Alice
│       ├── bob.py           # 角色: Bob
│       └── ...
├── environment/             # 环境系统
│   ├── map.py              # 地图系统
│   ├── locations.py        # 位置管理
│   ├── objects.py          # 物品系统
│   └── physics.py          # 物理引擎
├── social/                  # 社交系统
│   ├── relationships.py    # 关系管理
│   ├── conversations.py    # 对话系统
│   └── group_activities.py # 群体活动
├── simulation/              # 模拟引擎
│   ├── scheduler.py        # 任务调度
│   ├── step_manager.py     # 步骤管理
│   └── state_manager.py    # 状态管理
├── llm/                     # 大语言模型接口
│   ├── ollama_client.py    # Ollama 接口
│   ├── prompt_templates.py # 提示模板
│   └── response_parser.py  # 响应解析
├── ui/                      # 用户界面
│   ├── web_ui.py           # Web 界面
│   ├── map_renderer.py     # 地图渲染
│   └── static/             # 静态资源
│       ├── css/
│       ├── js/
│       └── images/
├── api/                     # API 服务
│   ├── main.py             # FastAPI 主程序
│   ├── endpoints/          # API 端点
│   └── websocket.py        # 实时通信
├── data/                    # 数据存储
│   ├── characters/         # 角色数据
│   ├── world_state/        # 世界状态
│   ├── memories/           # 记忆数据
│   └── logs/               # 日志文件
└── config/                  # 配置文件
    ├── settings.py         # 系统配置
    ├── character_configs/  # 角色配置
    └── world_config.py     # 世界配置
```

## 核心组件详解

### 1. 智能体架构 (Agent Architecture)

基于论文中的架构设计：

```
Agent = Memory Stream + Planning + Reflection
```

#### 记忆流 (Memory Stream)
- **观察记录**：记录所见所闻
- **重要性评分**：根据重要性存储和检索记忆
- **时间衰减**：记忆随时间逐渐淡忘

#### 反思机制 (Reflection)
- **高级洞察**：从具体记忆中抽取抽象概念
- **模式识别**：识别行为和事件模式
- **自我认知**：更新自我和他人的认知

#### 计划系统 (Planning)
- **高层计划**：长期目标和日常安排
- **中层计划**：具体任务分解
- **原子动作**：可执行的基本行为

### 2. 环境系统 (Environment)

#### 地图系统
- **网格地图**：基于瓦片的2D地图
- **可访问性**：路径规划和碰撞检测
- **区域功能**：不同区域的特殊功能

#### 物理引擎
- **移动系统**：角色移动和路径规划
- **碰撞检测**：避免重叠和障碍物
- **视野系统**：限制角色感知范围

### 3. 社交系统 (Social System)

#### 关系网络
- **关系强度**：友谊程度的量化
- **关系类型**：朋友、家人、同事等
- **动态变化**：关系随互动而变化

#### 对话系统
- **上下文感知**：基于历史和环境的对话
- **多轮对话**：支持复杂的交流
- **情感表达**：情绪在对话中的体现

## 实现计划

### 阶段 1：基础架构 (1-2周)
1. **核心系统**：世界状态、时间管理、事件系统
2. **基础智能体**：简单的智能体框架
3. **简单环境**：基本的地图和移动系统

### 阶段 2：记忆和规划 (2-3周)
1. **记忆系统**：记忆流的完整实现
2. **规划系统**：行为规划和目标管理
3. **反思机制**：高级认知能力

### 阶段 3：社交和交互 (2-3周)
1. **对话系统**：自然语言交流
2. **关系管理**：社交网络构建
3. **群体活动**：多智能体协作

### 阶段 4：用户界面 (1-2周)
1. **Web 界面**：实时观察系统
2. **地图可视化**：角色和环境展示
3. **交互控制**：用户干预能力

### 阶段 5：优化和扩展 (持续)
1. **性能优化**：提升模拟效率
2. **更多角色**：丰富角色多样性
3. **复杂场景**：添加更多活动类型

## 技术栈

- **后端框架**：FastAPI + asyncio
- **前端**：HTML5 Canvas + WebSocket
- **LLM 集成**：Ollama (本地) + OpenAI API (可选)
- **数据存储**：SQLite + JSON
- **实时通信**：WebSocket
- **任务调度**：asyncio + APScheduler

## 开始实现

让我知道您是否认同这个设计方向，我可以开始实现核心的智能体系统！
